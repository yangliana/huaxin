import{_ as h}from"./editor.vue_vue_type_script_setup_true_lang-De6njfV_.js";import{d as x,s as V,B as T,C as k,r as A,o as B,c as U,a as q,w as t,b as r,q as E,h as g,G as F,t as S,E as i,x as D,i as M,e as s,H as N,g as R,V as j,u as y}from"./index-DxW6Q-Ya.js";import{h as _}from"./moment-C5S46NFB.js";import{r as m}from"./validate-BxfLMkoi.js";import{s as H,b as P}from"./admin-BQebbhHa.js";import{_ as $}from"./article-cover.vue_vue_type_script_setup_true_lang-DveWnE_9.js";import{V as z}from"./VForm-C0AiPW46.js";import{V as n}from"./VTextField-DVQR5kpu.js";import"./quill.imageUploader-DIZujKzI.js";import"./uploadImage.vue_vue_type_script_setup_true_lang-BCoKKDIs.js";import"./VFileInput-seo5NRKL.js";import"./VField-J_Ggzm4Y.js";import"./VInput-p3egmL7t.js";import"./VDialog-Cb9aY2Jf.js";import"./VHover-zJvRixXI.js";const oe=x({__name:"edit",props:["id"],setup(v){const c=v,f=V(null),u=V(null),p=T(),w=k(),e=A({loading:!1,record:{category:"",title:"",raw:null,html:"",summary:"",author:"管理员",createTime:_().format("yyyy-MM-DD")}}),b=()=>{f.value.validate().then(({valid:o,errors:a})=>{if(!o)return Promise.reject(!1);var d=u.value.getContent();if(!d.html||!d.raw)return y().show("正文内容不能为空",{color:"red"}),Promise.reject(!1);e.record.html=d.html,e.record.raw=d.raw,e.record.summary=d.text.substring(0,100)}).then(()=>(e.loading=!0,H(e.record))).then(o=>{o.data&&o.data.code===200&&(y().show("编辑成功"),setTimeout(()=>{var a=p.meta.type==="news"?"/admin/article/news?category="+e.record.category:"/admin/article/case-study?category="+e.record.category;w.push(a)},1e3))}).finally(()=>{e.loading=!1})},C=()=>{c.id>0&&(e.loading=!0,P(c.id).then(o=>{if(o.data&&o.data.code===200){e.record=o.data.data;var a=JSON.parse(e.record.raw);u.value.setContent(a)}}).finally(()=>{e.loading=!1}))};return B(()=>{C()}),(o,a)=>{const d=h;return q(),U(j,{loading:e.loading,"max-width":"1000"},{default:t(()=>[r(E,{class:"bg-info"},{default:t(()=>[r(F,{icon:"mdi-plus",size:"small",class:"mr-1"}),g(" 编辑"+S(i(p).meta.type==="news"?"新闻":"案例"),1)]),_:1}),r(D,null,{default:t(()=>[r(z,{ref_key:"refForm",ref:f},{default:t(()=>[r(M,{dense:"",class:"mt-3"},{default:t(()=>[r(s,{cols:"4"},{default:t(()=>[r(n,{modelValue:e.record.category,"onUpdate:modelValue":a[0]||(a[0]=l=>e.record.category=l),label:"分类",disabled:""},null,8,["modelValue"])]),_:1}),r(s,{cols:"4"},{default:t(()=>[r(n,{modelValue:e.record.author,"onUpdate:modelValue":a[1]||(a[1]=l=>e.record.author=l),label:"作者",rules:[i(m).required]},null,8,["modelValue","rules"])]),_:1}),r(s,{cols:"4"},{default:t(()=>[r(n,{modelValue:e.record.createTime,"onUpdate:modelValue":a[2]||(a[2]=l=>e.record.createTime=l),label:"创建日期",type:"date",rules:[i(m).required],disabled:i(_)(e.record.createTime).isValid()},null,8,["modelValue","rules","disabled"])]),_:1}),r(s,{cols:"12"},{default:t(()=>[r(n,{modelValue:e.record.title,"onUpdate:modelValue":a[3]||(a[3]=l=>e.record.title=l),label:"标题",rules:[i(m).required],counter:""},null,8,["modelValue","rules"])]),_:1}),r(s,{cols:"12"},{default:t(()=>[r($,{modelValue:e.record.cover,"onUpdate:modelValue":a[4]||(a[4]=l=>e.record.cover=l),refEditor:u.value},null,8,["modelValue","refEditor"])]),_:1}),r(s,{cols:"12"},{default:t(()=>[r(d,{ref_key:"refArticle",ref:u,minHeight:"500"},null,512)]),_:1})]),_:1})]),_:1},512)]),_:1}),r(N,null,{default:t(()=>[r(R,{variant:"elevated",color:"primary",onClick:b},{default:t(()=>a[5]||(a[5]=[g("保存")])),_:1,__:[5]})]),_:1})]),_:1},8,["loading"])}}});export{oe as default};
