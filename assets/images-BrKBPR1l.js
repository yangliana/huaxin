import{a6 as _e,aF as N,aH as D,E as Q,aG as ze,b as o,F as H,aX as ue,aL as He,U as Ge,aU as We,s as z,aV as Je,bf as Qe,aW as ve,bJ as J,aP as Xe,R as B,aY as me,aM as ge,aN as Ye,af as Ze,G as he,bK as qe,n as el,I as j,a0 as ll,p as be,ax as tl,aZ as al,v as nl,a_ as ul,h as R,a$ as rl,b0 as ol,b1 as sl,b3 as ye,bL as il,d as ke,r as Ve,o as cl,c as E,a as S,V as re,w as h,g as G,q as Ce,i as pe,y as oe,z as Fe,e as we,m as xe,K as ee,x as Ie,u as Se,l as fl,bM as dl,_ as vl}from"./index-Dc9JgZ5a.js";import{r as ml}from"./validate-BxfLMkoi.js";import{g as gl}from"./admin-Dn8ru81H.js";import{V as hl}from"./VForm-_qL_3cmE.js";import{V as se,m as bl}from"./VTextField-C-kUFvZN.js";import{u as yl,a as xl,m as _l}from"./VSelect-CWAQoyOf.js";import{u as kl}from"./VInput-HubAIwMk.js";import{V as Vl}from"./VCheckboxBtn-C2Ao_qol.js";import{_ as Cl}from"./uploadImage.vue_vue_type_script_setup_true_lang-DzvJfy5G.js";import{V as pl}from"./VHover-uTpBFiAi.js";const Fl=(e,d,u)=>{if(e==null||d==null)return-1;if(!d.length)return 0;e=e.toString().toLocaleLowerCase(),d=d.toString().toLocaleLowerCase();const a=[];let n=e.indexOf(d);for(;~n;)a.push([n,n+d.length]),n=e.indexOf(d,n+d.length);return a.length?a:-1};function ne(e,d){if(!(e==null||typeof e=="boolean"||e===-1))return typeof e=="number"?[[e,e+d.length]]:Array.isArray(e[0])?e:[e]}const wl=_e({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function Il(e,d,u){var C;const a=[],n=(u==null?void 0:u.default)??Fl,b=u!=null&&u.filterKeys?ue(u.filterKeys):!1,y=Object.keys((u==null?void 0:u.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return a;e:for(let s=0;s<e.length;s++){const[c,f=c]=ue(e[s]),t={},m={};let x=-1;if((d||y>0)&&!(u!=null&&u.noFilter)){if(typeof c=="object"){const W=b||Object.keys(f);for(const K of W){const v=He(f,K),T=(C=u==null?void 0:u.customKeyFilter)==null?void 0:C[K];if(x=T?T(v,d,c):n(v,d,c),x!==-1&&x!==!1)T?t[K]=ne(x,d):m[K]=ne(x,d);else if((u==null?void 0:u.filterMode)==="every")continue e}}else x=n(c,d,c),x!==-1&&x!==!1&&(m.title=ne(x,d));const F=Object.keys(m).length,A=Object.keys(t).length;if(!F&&!A||(u==null?void 0:u.filterMode)==="union"&&A!==y&&!F||(u==null?void 0:u.filterMode)==="intersection"&&(A!==y||!F))continue}a.push({index:s,matches:{...m,...t}})}return a}function Sl(e,d,u,a){const n=N([]),b=N(new Map),y=D(()=>Q(d));ze(()=>{const s=typeof u=="function"?u():Q(u),c=typeof s!="string"&&typeof s!="number"?"":String(s),f=Il(y.value,c,{customKeyFilter:{...e.customKeyFilter,...Q(a==null?void 0:a.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),t=Q(d),m=[],x=new Map;f.forEach(F=>{let{index:A,matches:W}=F;const K=t[A];m.push(K),x.set(K.value,W)}),n.value=m,b.value=x});function C(s){return b.value.get(s.value)}return{filteredItems:n,filteredMatches:b,getMatches:C}}function Al(e,d,u){return u==null||!u.length?d:u.map((a,n)=>{const b=n===0?0:u[n-1][1],y=[o("span",{class:`${e}__unmask`},[d.slice(b,a[0])]),o("span",{class:`${e}__mask`},[d.slice(a[0],a[1])])];return n===u.length-1&&y.push(o("span",{class:`${e}__unmask`},[d.slice(a[1])])),o(H,null,[y])})}const Ml=_e({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...wl({filterKeys:["title"]}),..._l({hideNoData:!0,returnObject:!0}),...sl(bl({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...ol({transition:!1})},"VCombobox"),Pl=Ge()({name:"VCombobox",props:Ml(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,d){var ce;let{emit:u,slots:a}=d;const{t:n}=We(),b=z(),y=N(!1),C=N(!0),s=N(!1),c=z(),f=z(),t=N(-1);let m=!1;const{items:x,transformIn:F,transformOut:A}=Je(e),{textColorClasses:W,textColorStyles:K}=Qe(()=>{var l;return(l=b.value)==null?void 0:l.color}),v=ve(e,"modelValue",[],l=>F(ue(l)),l=>{const r=A(l);return e.multiple?r:r[0]??null}),T=kl(e),X=D(()=>!!(e.chips||a.chip)),L=D(()=>X.value||!!a.selection),O=N(!e.multiple&&!L.value?((ce=v.value[0])==null?void 0:ce.title)??"":""),p=D({get:()=>O.value,set:l=>{var r;if(O.value=l??"",!e.multiple&&!L.value&&(v.value=[J(e,l)]),l&&e.multiple&&((r=e.delimiters)!=null&&r.length)){const _=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));_.length>1&&(_.forEach(i=>{i=i.trim(),i&&M(J(e,i))}),O.value="")}l||(t.value=-1),C.value=!l}}),Ae=D(()=>typeof e.counterValue=="function"?e.counterValue(v.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?v.value.length:p.value.length),{filteredItems:Y,getMatches:Me}=Sl(e,x,()=>C.value?"":p.value),U=D(()=>e.hideSelected?Y.value.filter(l=>!v.value.some(r=>r.value===l.value)):Y.value),Z=D(()=>e.hideNoData&&!U.value.length||T.isReadonly.value||T.isDisabled.value),le=ve(e,"menu"),k=D({get:()=>le.value,set:l=>{var r;le.value&&!l&&((r=c.value)!=null&&r.ΨopenChildren.size)||l&&Z.value||(le.value=l)}}),ie=Xe(()=>k.value?e.closeText:e.openText);B(O,l=>{m?ge(()=>m=!1):y.value&&!k.value&&(k.value=!0),u("update:search",l)}),B(v,l=>{var r;!e.multiple&&!L.value&&(O.value=((r=l[0])==null?void 0:r.title)??"")});const Pe=D(()=>v.value.map(l=>l.value)),te=D(()=>{var r;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&p.value===((r=U.value[0])==null?void 0:r.title))&&U.value.length>0&&!C.value&&!s.value}),ae=z(),De=yl(ae,b);function Ke(l){m=!0,e.openOnClear&&(k.value=!0)}function Le(){Z.value||(k.value=!0)}function Ee(l){Z.value||(y.value&&(l.preventDefault(),l.stopPropagation()),k.value=!k.value)}function Re(l){var r;l.key!==" "&&ye(l)&&((r=b.value)==null||r.focus())}function Te(l){var i,V,w,P;if(il(l)||T.isReadonly.value)return;const r=(i=b.value)==null?void 0:i.selectionStart,_=v.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(k.value=!0),["Escape"].includes(l.key)&&(k.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(te.value&&["Enter","Tab"].includes(l.key)&&!v.value.some(g=>{let{value:$}=g;return $===U.value[0].value})&&M(Y.value[0]),C.value=!0),l.key==="ArrowDown"&&te.value&&((V=ae.value)==null||V.focus("next")),l.key==="Enter"&&p.value&&(M(J(e,p.value)),L.value&&(O.value="")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&L.value&&v.value.length>0&&!p.value)return M(v.value[0],!1);if(~t.value){l.preventDefault();const g=t.value;M(v.value[t.value],!1),t.value=g>=_-1?_-2:g}else l.key==="Backspace"&&!p.value&&(t.value=_-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(t.value<0&&r&&r>0)return;const g=t.value>-1?t.value-1:_-1;v.value[g]?t.value=g:(t.value=-1,(w=b.value)==null||w.setSelectionRange(p.value.length,p.value.length))}else if(l.key==="ArrowRight"){if(t.value<0)return;const g=t.value+1;v.value[g]?t.value=g:(t.value=-1,(P=b.value)==null||P.setSelectionRange(0,0))}else~t.value&&ye(l)&&(t.value=-1)}function Oe(){var l;e.eager&&((l=f.value)==null||l.calculateVisibleItems())}function Ue(){var l;y.value&&(C.value=!0,(l=b.value)==null||l.focus())}function M(l){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const _=v.value.findIndex(V=>(e.valueComparator||me)(V.value,l.value)),i=r??!~_;if(~_){const V=i?[...v.value,l]:[...v.value];V.splice(_,1),v.value=V}else i&&(v.value=[...v.value,l]);e.clearOnSelect&&(p.value="")}else{const _=r!==!1;v.value=_?[l]:[],O.value=_&&!L.value?l.title:"",ge(()=>{k.value=!1,C.value=!0})}}function $e(l){y.value=!0,setTimeout(()=>{s.value=!0})}function Be(l){s.value=!1}function je(l){(l==null||l===""&&!e.multiple&&!L.value)&&(v.value=[])}return B(y,(l,r)=>{if(!(l||l===r)&&(t.value=-1,k.value=!1,p.value)){if(e.multiple){M(J(e,p.value));return}if(!L.value)return;v.value.some(_=>{let{title:i}=_;return i===p.value})?O.value="":M(J(e,p.value))}}),B(k,()=>{if(!e.hideSelected&&k.value&&v.value.length){const l=U.value.findIndex(r=>v.value.some(_=>(e.valueComparator||me)(_.value,r.value)));Ye&&window.requestAnimationFrame(()=>{var r;l>=0&&((r=f.value)==null||r.scrollToIndex(l))})}}),B(()=>e.items,(l,r)=>{k.value||y.value&&!r.length&&l.length&&(k.value=!0)}),Ze(()=>{const l=!!(!e.hideNoData||U.value.length||a["prepend-item"]||a["append-item"]||a["no-data"]),r=v.value.length>0,_=se.filterProps(e);return o(se,j({ref:b},_,{modelValue:p.value,"onUpdate:modelValue":[i=>p.value=i,je],focused:y.value,"onUpdate:focused":i=>y.value=i,validationValue:v.externalValue,counterValue:Ae.value,dirty:r,class:["v-combobox",{"v-combobox--active-menu":k.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!L.value,"v-combobox--selecting-index":t.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:T.isReadonly.value,placeholder:r?void 0:e.placeholder,"onClick:clear":Ke,"onMousedown:control":Le,onKeydown:Te}),{...a,default:()=>o(H,null,[o(el,j({ref:c,modelValue:k.value,"onUpdate:modelValue":i=>k.value=i,activator:"parent",contentClass:"v-combobox__content",disabled:Z.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:Oe,onAfterLeave:Ue},e.menuProps),{default:()=>[l&&o(ll,j({ref:ae,selected:Pe.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:i=>i.preventDefault(),onKeydown:Re,onFocusin:$e,onFocusout:Be,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},De,e.listProps),{default:()=>{var i,V,w;return[(i=a["prepend-item"])==null?void 0:i.call(a),!U.value.length&&!e.hideNoData&&(((V=a["no-data"])==null?void 0:V.call(a))??o(be,{key:"no-data",title:n(e.noDataText)},null)),o(xl,{ref:f,renderless:!0,items:U.value,itemKey:"value"},{default:P=>{var de;let{item:g,index:$,itemRef:I}=P;const fe=j(g.props,{ref:I,key:g.value,active:te.value&&$===0?!0:void 0,onClick:()=>M(g,null)});return((de=a.item)==null?void 0:de.call(a,{item:g,index:$,props:fe}))??o(be,j(fe,{role:"option"}),{prepend:q=>{let{isSelected:Ne}=q;return o(H,null,[e.multiple&&!e.hideSelected?o(Vl,{key:g.value,modelValue:Ne,ripple:!1,tabindex:"-1"},null):void 0,g.props.prependAvatar&&o(tl,{image:g.props.prependAvatar},null),g.props.prependIcon&&o(he,{icon:g.props.prependIcon},null)])},title:()=>{var q;return C.value?g.title:Al("v-combobox",g.title,(q=Me(g))==null?void 0:q.title)}})}}),(w=a["append-item"])==null?void 0:w.call(a)]}})]}),v.value.map((i,V)=>{function w(I){I.stopPropagation(),I.preventDefault(),M(i,!1)}const P={"onClick:close":w,onKeydown(I){I.key!=="Enter"&&I.key!==" "||(I.preventDefault(),I.stopPropagation(),w(I))},onMousedown(I){I.preventDefault(),I.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},g=X.value?!!a.chip:!!a.selection,$=g?al(X.value?a.chip({item:i,index:V,props:P}):a.selection({item:i,index:V})):void 0;if(!(g&&!$))return o("div",{key:i.value,class:["v-combobox__selection",V===t.value&&["v-combobox__selection--selected",W.value]],style:V===t.value?K.value:{}},[X.value?a.chip?o(ul,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:i.title}}},{default:()=>[$]}):o(nl,j({key:"chip",closable:e.closableChips,size:"small",text:i.title,disabled:i.props.disabled},P),null):$??o("span",{class:"v-combobox__selection-text"},[i.title,e.multiple&&V<v.value.length-1&&o("span",{class:"v-combobox__selection-comma"},[R(",")])])])})]),"append-inner":function(){var P,g;for(var i=arguments.length,V=new Array(i),w=0;w<i;w++)V[w]=arguments[w];return o(H,null,[(P=a["append-inner"])==null?void 0:P.call(a,...V),(!e.hideNoData||e.items.length)&&e.menuIcon?o(he,{class:"v-combobox__menu-icon",color:(g=b.value)==null?void 0:g.fieldIconColor,icon:e.menuIcon,onMousedown:Ee,onClick:qe,"aria-label":n(ie.value),title:n(ie.value),tabindex:"-1"},null):void 0])}})}),rl({isFocused:y,isPristine:C,menu:k,search:p,selectionIndex:t,filteredItems:Y,select:M},b)}}),zl=ke({__name:"attrs",props:["attrs"],setup(e,{expose:d}){const u=e,a=z(null),n=Ve({loading:!1,optionalAttrList:[],records:[]}),b=f=>{n.records.splice(f,1)},y=()=>{n.records.push({name:null,value:null})},C=f=>{var t=f.label;if(t){var m=!1;if(n.records.forEach(x=>{x.name==t&&(m=!0)}),m){Se().show(t+"已存在",{color:"red"});return}f.name=t,delete f.label}},s=()=>a.value.validate().then(({valid:f,errors:t})=>f?n.records:Promise.reject(t));B(()=>u.attrs,(f,t)=>{Array.isArray(f)&&f!==t&&(n.records=f)});const c=()=>{gl("product-attr").then(f=>{f.data&&f.data.code===200&&(n.definedAttrList=f.data.data),n.definedAttrList.forEach(t=>{t.name&&(t.required?n.records.push({name:t.name,value:null}):n.optionalAttrList.push(t.name))})})};return cl(()=>{c()}),d({getData:s}),(f,t)=>(S(),E(re,{class:"my-3"},{default:h(()=>[o(Ce,{class:"text-blue bg-blue-lighten-5 text-subtitle-1 d-flex justify-space-between"},{default:h(()=>[t[1]||(t[1]=R(" 产品属性 ")),o(G,{size:"small",variant:"elevated",color:"primary",onClick:y},{default:h(()=>t[0]||(t[0]=[R(" 添加属性 ")])),_:1,__:[0]})]),_:1,__:[1]}),o(Ie,{class:"py-3"},{default:h(()=>[o(hl,{ref_key:"refForm",ref:a},{default:h(()=>[o(pe,{dense:""},{default:h(()=>[(S(!0),oe(H,null,Fe(n.records,(m,x)=>(S(),E(we,{lg:"3",xl:"3",md:"4",sm:"6"},{default:h(()=>[m.name?(S(),E(se,{key:0,modelValue:m.value,"onUpdate:modelValue":F=>m.value=F,label:m.name,rules:[Q(ml).required]},{"append-inner":h(()=>[o(G,{size:"small",variant:"plain",color:"red",onClick:xe(F=>b(x),["prevent"])},{default:h(()=>t[2]||(t[2]=[R("删除")])),_:2,__:[2]},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","label","rules"])):(S(),E(Pl,{key:1,modelValue:m.label,"onUpdate:modelValue":F=>m.label=F,label:"属性",items:n.optionalAttrList},{"append-inner":h(()=>[m.label?(S(),E(G,{key:0,size:"small",variant:"plain",color:"red",onClick:xe(F=>C(m),["prevent"])},{default:h(()=>t[3]||(t[3]=[R("OK")])),_:2,__:[3]},1032,["onClick"])):ee("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","items"]))]),_:2},1024))),256))]),_:1})]),_:1},512)]),_:1})]),_:1}))}}),Dl={key:0,class:"d-flex bg-grey v-card--reveal text-h2",style:{height:"100%"}},Kl=ke({__name:"images",props:["images","cover"],setup(e,{expose:d}){const u=e,a=z(null),n=Ve({loading:!1,records:["","","",""],cover:""}),b=s=>{n.records[s]=""},y=s=>{n.records[s]&&(n.cover=n.records[s])},C=()=>{var s=[];for(let c=0;c<n.records.length;++c)n.records[c]&&(s.push(n.records[c]),n.cover||(n.cover=n.records[c]));return s.length===0?(Se().show("至少上传1张产品图",{color:"red"}),Promise.reject(!1)):{images:s,cover:n.cover}};return B(()=>u.images,(s,c)=>{if(Array.isArray(s)&&s!==c)for(let f=0;f<n.records.length;++f)s[f]&&(n.records[f]=s[f])}),B(()=>u.cover,(s,c)=>{s&&s!==c&&(n.cover=s)}),d({getData:C}),(s,c)=>{const f=Cl;return S(),E(re,{class:"my-3"},{default:h(()=>[o(Ce,{class:"text-blue bg-blue-lighten-5 text-subtitle-1"},{default:h(()=>c[1]||(c[1]=[R(" 产品相册 ")])),_:1,__:[1]}),o(Ie,{class:"py-3"},{default:h(()=>[o(f,{ref_key:"refUpload",ref:a,onSuccess:c[0]||(c[0]=(t,m)=>n.records[m]=t)},null,512),o(pe,{dense:""},{default:h(()=>[(S(!0),oe(H,null,Fe(n.records,(t,m)=>(S(),E(we,{lg:"3",xl:"3",md:"4",sm:"6"},{default:h(()=>[o(pl,null,{default:h(({isHovering:x,props:F})=>[o(re,j({"max-width":"500",variant:"text",color:"white",ref_for:!0},F),{default:h(()=>[o(fl,{src:t||"/images/404.png",height:"240",cover:""},{default:h(()=>[o(dl,null,{default:h(()=>[x?(S(),oe("div",Dl,[o(G,{color:"primary",size:"small",class:"mx-1",onClick:A=>a.value.trigger(m)},{default:h(()=>c[2]||(c[2]=[R("上传图")])),_:2,__:[2]},1032,["onClick"]),t?(S(),E(G,{key:0,color:"error",size:"small",class:"mx-1",onClick:A=>b(m)},{default:h(()=>c[3]||(c[3]=[R("删除")])),_:2,__:[3]},1032,["onClick"])):ee("",!0),t&&t!=n.cover?(S(),E(G,{key:1,color:"success",size:"small",class:"mx-1",onClick:A=>y(m)},{default:h(()=>c[4]||(c[4]=[R("设为封面")])),_:2,__:[4]},1032,["onClick"])):ee("",!0)])):ee("",!0)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1040)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1})}}}),Hl=vl(Kl,[["__scopeId","data-v-ac08a5e2"]]);export{Hl as A,zl as _};
