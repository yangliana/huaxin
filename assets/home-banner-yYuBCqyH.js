import{d as x,s as u,r as F,o as h,c as g,a as m,w as l,b as t,q as I,h as i,G as b,k as S,x as w,y as B,aC as z,E,F as T,z as j,V,l as q,g as c,H as P,u as _}from"./index-5qLLyIeV.js";import{i as $,k as D,g as N}from"./admin-DLqVeSft.js";import{V as R}from"./VForm-BVR9RGWn.js";import{V as A}from"./VFileInput-DGV_Yj8n.js";import{V as G}from"./VTextField-B4mZyLTN.js";import"./VInput-SPoS7vey.js";import"./VField-D1jQj0sG.js";const X=x({__name:"home-banner",setup(H){const d=u(null),f=u(null),p=u(null),r=F({loading:!1,type:"homepage-banner",maxCounts:4,currentIndex:0,records:[]});function v(a){r.currentIndex=a,f.value.$el.querySelector('input[type="file"]').click()}const y=a=>new Promise((e,n)=>{const s=new FormData;s.append("image",a),$(s).then(o=>o.data.data).then(o=>{r.records[r.currentIndex].imgUrl=o}).catch(o=>{console.error("Error:",o)})}),C=a=>{r.records[a].imgUrl="",r.records[a].toUrl=""},k=()=>{r.loading=!0,p.value.validate().then(a=>{if(!a.valid)return Promise.reject(!1);var e=!1;return r.records.forEach(n=>{n.imgUrl&&(e=!0)}),e?D(r.type,r.records):(_().show("至少需要一张横幅图",{color:"red"}),Promise.reject(!1))}).then(a=>{a.data&&a.data.code===200&&_().show("保存成功")}).finally(()=>{r.loading=!1})},U=()=>{N(r.type).then(a=>{if(a.data&&a.data.code===200){r.records=a.data.data;for(let e=r.records.length;e<r.maxCounts;++e)r.records.push({imgUrl:"",toUrl:""})}}).catch(a=>{console.error(a)})};return h(()=>{U()}),(a,e)=>(m(),g(V,{loading:r.loading,"max-width":"1000"},{default:l(()=>[t(I,{class:"bg-primary"},{default:l(()=>[t(b,{icon:"mdi-image-multiple-outline",size:"small",class:"mr-1"}),e[1]||(e[1]=i(" 首页横幅 "))]),_:1,__:[1]}),t(S,{class:"bg-grey-lighten-2 py-2"},{default:l(()=>e[2]||(e[2]=[i(" 首页横幅用于在首页展示通栏滚动图 ")])),_:1,__:[2]}),t(w,null,{default:l(()=>[t(R,{ref_key:"refForm",ref:p},{default:l(()=>[t(A,{ref_key:"refFileInput",ref:f,modelValue:E(d),"onUpdate:modelValue":[e[0]||(e[0]=n=>z(d)?d.value=n:null),y],accept:"image/*",class:"d-none"},null,8,["modelValue"]),(m(!0),B(T,null,j(r.records,(n,s)=>(m(),g(V,{variant:"text"},{default:l(()=>[t(q,{src:n.imgUrl||"/images/404.png"},null,8,["src"]),t(G,{modelValue:n.toUrl,"onUpdate:modelValue":o=>n.toUrl=o,label:"链接地址",placeholder:"点击横幅图跳转的链接地址（可选）"},{"append-inner":l(()=>[t(c,{color:"primary",size:"small",variant:"plain",onClick:o=>v(s)},{default:l(()=>e[3]||(e[3]=[i("上传横幅图")])),_:2,__:[3]},1032,["onClick"]),t(c,{color:"error",size:"small",variant:"plain",onClick:o=>C(s)},{default:l(()=>e[4]||(e[4]=[i("删除")])),_:2,__:[4]},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024))),256))]),_:1},512)]),_:1}),t(P,null,{default:l(()=>[t(c,{loading:r.loading,variant:"elevated",color:"primary",onClick:k},{default:l(()=>e[5]||(e[5]=[i("保存")])),_:1,__:[5]},8,["loading"])]),_:1})]),_:1},8,["loading"]))}});export{X as default};
