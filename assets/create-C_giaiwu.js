import{_ as b}from"./editor.vue_vue_type_script_setup_true_lang-Go7SmwAZ.js";import{d as C,B as p,s as V,C as x,r as h,c as T,a as k,w as o,b as r,q,D as U,E as u,h as y,G as A,t as B,x as D,i as E,e as s,H as F,g as R,V as S,u as g}from"./index-CBPGFmfO.js";import{h as j}from"./moment-C5S46NFB.js";import{r as c}from"./validate-BxfLMkoi.js";import{s as z}from"./admin-bFQgo93F.js";import{_ as H}from"./article-cover.vue_vue_type_script_setup_true_lang-LmUsV-g2.js";import{V as M}from"./VForm-BPx39aqs.js";import{V as m}from"./VTextField-BEe9Nexe.js";import"./quill.imageUploader-D88r1wV1.js";import"./uploadImage.vue_vue_type_script_setup_true_lang-DstlEzKI.js";import"./VFileInput-CN8e6bKn.js";import"./VField-BzBafDPM.js";import"./VInput-jMiW4Vic.js";import"./VDialog-e2wHpJuU.js";import"./VHover-B3Vo0u3z.js";const ae=C({__name:"create",setup(N){const _=p().query.category||"公司新闻",f=V(null),i=V(null),n=p(),v=x(),e=h({loading:!1,record:{category:_,title:"",raw:null,html:"",summary:"",author:"管理员",createTime:j().format("yyyy-MM-DD")}}),w=()=>{f.value.validate().then(({valid:d,errors:a})=>{if(!d)return Promise.reject(!1);var l=i.value.getContent();if(!l.html)return g().show("正文内容不能为空",{color:"red"}),Promise.reject(!1);e.record.html=l.html,e.record.raw=l.raw,e.record.summary=l.text.substring(0,100)}).then(()=>(e.loading=!0,z(e.record))).then(d=>{d.data&&d.data.code===200&&(g().show("创建成功"),setTimeout(()=>{var a=n.meta.type==="news"?"/admin/article/news?category="+e.record.category:"/admin/article/case-study?category="+e.record.category;v.push(a)},1e3))}).finally(()=>{e.loading=!1})};return(d,a)=>{const l=b;return k(),T(S,{loading:e.loading,"max-width":"1000"},{default:o(()=>[r(q,{class:U(u(n).meta.type=="news"?"bg-blue":"bg-green")},{default:o(()=>[r(A,{icon:"mdi-plus",size:"small",class:"mr-1"}),y(" 创建"+B(u(n).meta.type==="news"?"新闻":"案例"),1)]),_:1},8,["class"]),r(D,null,{default:o(()=>[r(M,{ref_key:"refForm",ref:f},{default:o(()=>[r(E,{dense:"",class:"mt-3"},{default:o(()=>[r(s,{cols:"4"},{default:o(()=>[r(m,{modelValue:e.record.category,"onUpdate:modelValue":a[0]||(a[0]=t=>e.record.category=t),label:"分类",disabled:""},null,8,["modelValue"])]),_:1}),r(s,{cols:"4"},{default:o(()=>[r(m,{modelValue:e.record.author,"onUpdate:modelValue":a[1]||(a[1]=t=>e.record.author=t),label:"作者",rules:[u(c).required]},null,8,["modelValue","rules"])]),_:1}),r(s,{cols:"4"},{default:o(()=>[r(m,{modelValue:e.record.createTime,"onUpdate:modelValue":a[2]||(a[2]=t=>e.record.createTime=t),label:"创建日期",type:"date",rules:[u(c).required]},null,8,["modelValue","rules"])]),_:1}),r(s,{cols:"12"},{default:o(()=>[r(m,{modelValue:e.record.title,"onUpdate:modelValue":a[3]||(a[3]=t=>e.record.title=t),label:"标题",rules:[u(c).required],counter:""},null,8,["modelValue","rules"])]),_:1}),r(s,{cols:"12"},{default:o(()=>[r(H,{modelValue:e.record.cover,"onUpdate:modelValue":a[4]||(a[4]=t=>e.record.cover=t),refEditor:i.value},null,8,["modelValue","refEditor"])]),_:1}),r(s,{cols:"12"},{default:o(()=>[r(l,{ref_key:"refArticle",ref:i,minHeight:"500"},null,512)]),_:1})]),_:1})]),_:1},512)]),_:1}),r(F,null,{default:o(()=>[r(R,{variant:"elevated",color:"primary",onClick:w},{default:o(()=>a[5]||(a[5]=[y("创建")])),_:1,__:[5]})]),_:1})]),_:1},8,["loading"])}}});export{ae as default};
