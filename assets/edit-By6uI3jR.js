import{_ as C}from"./editor.vue_vue_type_script_setup_true_lang-B10Ek_Hn.js";import{d as k,C as b,s as l,r as S,o as T,c as I,a as N,w as o,b as a,q as P,v as A,h as u,g as B,x as D,i as c,e as f,E as p,V as E,u as F}from"./index-5qLLyIeV.js";import{r as g}from"./validate-BxfLMkoi.js";import{c as q,g as J,d as M}from"./admin-DLqVeSft.js";import{_ as O,A as j}from"./images-Da011fcC.js";import{h as H}from"./moment-C5S46NFB.js";import{V as R}from"./VForm-BVR9RGWn.js";import{V as U}from"./VSelect-CUrHFJDE.js";import{V as $}from"./VTextField-B4mZyLTN.js";import"./quill.imageUploader-aoSOINBg.js";import"./VInput-SPoS7vey.js";import"./VCheckboxBtn-CFlLoo1W.js";import"./VSelectionControl-D3T-oHIo.js";import"./uploadImage.vue_vue_type_script_setup_true_lang-Xy0lKqBm.js";import"./VFileInput-DGV_Yj8n.js";import"./VField-D1jQj0sG.js";import"./VHover-BCVZWZOe.js";const ie=k({__name:"edit",props:["id"],setup(_){const V=_,y=b(),v=parseInt(V.id),i=l(null),n=l(null),m=l(null),s=l(null),e=S({loading:!1,categoryList:[],record:{id:0,title:"",category:"",attrs:[],images:[],cover:"",raw:null,html:"",createTime:H().format("yyyy-MM-DD HH:mm:ss")}}),h=()=>{e.loading=!0,i.value.validate().then(r=>r.valid?Promise.all([n.value.getData(),m.value.getData(),s.value.getContent()]):Promise.reject(!1)).then(r=>(e.record.attrs=r[0],e.record.images=r[1].images,e.record.cover=r[1].cover,e.record.raw=r[2].raw,e.record.html=r[2].html,q(e.record))).then(r=>{r.data&&r.data.code===200&&F().show("保存成功")}).finally(()=>{e.loading=!1,setTimeout(()=>{y.push("/admin/product/list")},1500)})},w=()=>{e.loading=!0,J("product-category").then(r=>{r.data&&r.data.code===200&&(e.categoryList=r.data.data.map(t=>t.name))}).then(()=>M(v)).then(r=>{if(r.data&&r.data.code===200){let t=r.data.data;t.attrs=JSON.parse(t.attrs),t.images=JSON.parse(t.images),t.raw=JSON.parse(t.raw),e.record=t,s.value.setContent(t.raw)}}).finally(()=>{e.loading=!1})};return T(()=>{w()}),(r,t)=>{const x=C;return N(),I(E,{loading:e.loading},{default:o(()=>[a(P,{class:"bg-blue-lighten-1 py-1 d-flex justify-space-between"},{default:o(()=>[a(A,{variant:"text","prepend-icon":"mdi-pencil-outline",size:"large"},{default:o(()=>t[2]||(t[2]=[u("编辑产品")])),_:1,__:[2]}),a(B,{color:"orange-darken-1",disabled:e.loading,onClick:h},{default:o(()=>t[3]||(t[3]=[u("保存")])),_:1,__:[3]},8,["disabled"])]),_:1}),a(D,{class:"pt-3"},{default:o(()=>[a(R,{ref_key:"refForm",ref:i},{default:o(()=>[a(c,{dense:""},{default:o(()=>[a(f,{cols:"6",xl:"3",lg:"3",md:"4",sm:"6"},{default:o(()=>[a(U,{modelValue:e.record.category,"onUpdate:modelValue":t[0]||(t[0]=d=>e.record.category=d),"prepend-inner-icon":"mdi-shape-outline",label:"产品分类",rules:[p(g).required],items:e.categoryList},null,8,["modelValue","rules","items"])]),_:1})]),_:1}),a(c,{dense:""},{default:o(()=>[a(f,{cols:"6",xl:"6",md:"6",sm:"12"},{default:o(()=>[a($,{modelValue:e.record.title,"onUpdate:modelValue":t[1]||(t[1]=d=>e.record.title=d),"prepend-inner-icon":"mdi-rename-outline",label:"产品标题",rules:[p(g).required]},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(O,{ref_key:"refAttrs",ref:n,attrs:e.record.attrs},null,8,["attrs"]),a(j,{ref_key:"refImages",ref:m,images:e.record.images,cover:e.record.cover},null,8,["images","cover"]),a(x,{ref_key:"refEditor",ref:s},null,512)]),_:1},512)]),_:1})]),_:1},8,["loading"])}}});export{ie as default};
