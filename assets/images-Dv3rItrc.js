import{a6 as ke,aF as z,aH as P,E as Q,aG as ze,b as s,F as W,aX as ue,aL as He,U as Ge,aU as We,s as G,aV as Je,bf as Qe,aW as me,bJ as J,aP as Xe,R as U,aY as ge,aM as be,aN as Ye,af as Ze,G as he,bK as qe,n as el,I as N,a0 as ll,p as ye,ax as tl,aZ as al,v as nl,a_ as ul,h as R,a$ as rl,b0 as ol,b1 as sl,b3 as xe,bL as il,d as Ve,r as Ce,o as cl,c as E,a as S,V as re,w as b,g as H,q as pe,i as Fe,y as oe,z as we,e as Ie,m as _e,K as ee,x as Se,u as se,j as fl,l as dl,bM as vl,_ as ml}from"./index-Bf5RujO8.js";import{r as gl}from"./validate-BxfLMkoi.js";import{g as bl}from"./admin-DMXthsHm.js";import{V as hl}from"./VForm-BKyZDTFF.js";import{V as ie,m as yl}from"./VTextField-Xl2DqYbc.js";import{u as xl,a as _l,m as kl}from"./VSelect-B25nyp4L.js";import{u as Vl}from"./VInput-Dsj5u6P7.js";import{V as Cl}from"./VCheckboxBtn-EqwU6C0e.js";import{_ as pl}from"./uploadImage.vue_vue_type_script_setup_true_lang-BDYNxTNp.js";import{V as Fl}from"./VHover-CLyLb5pE.js";const wl=(e,f,r)=>{if(e==null||f==null)return-1;if(!f.length)return 0;e=e.toString().toLocaleLowerCase(),f=f.toString().toLocaleLowerCase();const n=[];let a=e.indexOf(f);for(;~a;)n.push([a,a+f.length]),a=e.indexOf(f,a+f.length);return n.length?n:-1};function ne(e,f){if(!(e==null||typeof e=="boolean"||e===-1))return typeof e=="number"?[[e,e+f.length]]:Array.isArray(e[0])?e:[e]}const Il=ke({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function Sl(e,f,r){var C;const n=[],a=(r==null?void 0:r.default)??wl,h=r!=null&&r.filterKeys?ue(r.filterKeys):!1,y=Object.keys((r==null?void 0:r.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return n;e:for(let V=0;V<e.length;V++){const[c,u=c]=ue(e[V]),t={},v={};let g=-1;if((f||y>0)&&!(r!=null&&r.noFilter)){if(typeof c=="object"){const T=h||Object.keys(u);for(const K of T){const d=He(u,K),O=(C=r==null?void 0:r.customKeyFilter)==null?void 0:C[K];if(g=O?O(d,f,c):a(d,f,c),g!==-1&&g!==!1)O?t[K]=ne(g,f):v[K]=ne(g,f);else if((r==null?void 0:r.filterMode)==="every")continue e}}else g=a(c,f,c),g!==-1&&g!==!1&&(v.title=ne(g,f));const F=Object.keys(v).length,D=Object.keys(t).length;if(!F&&!D||(r==null?void 0:r.filterMode)==="union"&&D!==y&&!F||(r==null?void 0:r.filterMode)==="intersection"&&(D!==y||!F))continue}n.push({index:V,matches:{...v,...t}})}return n}function Al(e,f,r,n){const a=z([]),h=z(new Map),y=P(()=>Q(f));ze(()=>{const V=typeof r=="function"?r():Q(r),c=typeof V!="string"&&typeof V!="number"?"":String(V),u=Sl(y.value,c,{customKeyFilter:{...e.customKeyFilter,...Q(n==null?void 0:n.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),t=Q(f),v=[],g=new Map;u.forEach(F=>{let{index:D,matches:T}=F;const K=t[D];v.push(K),g.set(K.value,T)}),a.value=v,h.value=g});function C(V){return h.value.get(V.value)}return{filteredItems:a,filteredMatches:h,getMatches:C}}function Ml(e,f,r){return r==null||!r.length?f:r.map((n,a)=>{const h=a===0?0:r[a-1][1],y=[s("span",{class:`${e}__unmask`},[f.slice(h,n[0])]),s("span",{class:`${e}__mask`},[f.slice(n[0],n[1])])];return a===r.length-1&&y.push(s("span",{class:`${e}__unmask`},[f.slice(n[1])])),s(W,null,[y])})}const Pl=ke({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...Il({filterKeys:["title"]}),...kl({hideNoData:!0,returnObject:!0}),...sl(yl({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...ol({transition:!1})},"VCombobox"),Dl=Ge()({name:"VCombobox",props:Pl(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,f){var fe;let{emit:r,slots:n}=f;const{t:a}=We(),h=G(),y=z(!1),C=z(!0),V=z(!1),c=G(),u=G(),t=z(-1);let v=!1;const{items:g,transformIn:F,transformOut:D}=Je(e),{textColorClasses:T,textColorStyles:K}=Qe(()=>{var l;return(l=h.value)==null?void 0:l.color}),d=me(e,"modelValue",[],l=>F(ue(l)),l=>{const o=D(l);return e.multiple?o:o[0]??null}),O=Vl(e),X=P(()=>!!(e.chips||n.chip)),L=P(()=>X.value||!!n.selection),$=z(!e.multiple&&!L.value?((fe=d.value[0])==null?void 0:fe.title)??"":""),p=P({get:()=>$.value,set:l=>{var o;if($.value=l??"",!e.multiple&&!L.value&&(d.value=[J(e,l)]),l&&e.multiple&&((o=e.delimiters)!=null&&o.length)){const x=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));x.length>1&&(x.forEach(i=>{i=i.trim(),i&&A(J(e,i))}),$.value="")}l||(t.value=-1),C.value=!l}}),Ae=P(()=>typeof e.counterValue=="function"?e.counterValue(d.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?d.value.length:p.value.length),{filteredItems:Y,getMatches:Me}=Al(e,g,()=>C.value?"":p.value),j=P(()=>e.hideSelected?Y.value.filter(l=>!d.value.some(o=>o.value===l.value)):Y.value),Z=P(()=>e.hideNoData&&!j.value.length||O.isReadonly.value||O.isDisabled.value),le=me(e,"menu"),_=P({get:()=>le.value,set:l=>{var o;le.value&&!l&&((o=c.value)!=null&&o.ΨopenChildren.size)||l&&Z.value||(le.value=l)}}),ce=Xe(()=>_.value?e.closeText:e.openText);U($,l=>{v?be(()=>v=!1):y.value&&!_.value&&(_.value=!0),r("update:search",l)}),U(d,l=>{var o;!e.multiple&&!L.value&&($.value=((o=l[0])==null?void 0:o.title)??"")});const Pe=P(()=>d.value.map(l=>l.value)),te=P(()=>{var o;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&p.value===((o=j.value[0])==null?void 0:o.title))&&j.value.length>0&&!C.value&&!V.value}),ae=G(),De=xl(ae,h);function Ke(l){v=!0,e.openOnClear&&(_.value=!0)}function Le(){Z.value||(_.value=!0)}function Ee(l){Z.value||(y.value&&(l.preventDefault(),l.stopPropagation()),_.value=!_.value)}function Re(l){var o;l.key!==" "&&xe(l)&&((o=h.value)==null||o.focus())}function Te(l){var i,k,w,M;if(il(l)||O.isReadonly.value)return;const o=(i=h.value)==null?void 0:i.selectionStart,x=d.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(_.value=!0),["Escape"].includes(l.key)&&(_.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(te.value&&["Enter","Tab"].includes(l.key)&&!d.value.some(m=>{let{value:B}=m;return B===j.value[0].value})&&A(Y.value[0]),C.value=!0),l.key==="ArrowDown"&&te.value&&((k=ae.value)==null||k.focus("next")),l.key==="Enter"&&p.value&&(A(J(e,p.value)),L.value&&($.value="")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&L.value&&d.value.length>0&&!p.value)return A(d.value[0],!1);if(~t.value){l.preventDefault();const m=t.value;A(d.value[t.value],!1),t.value=m>=x-1?x-2:m}else l.key==="Backspace"&&!p.value&&(t.value=x-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(t.value<0&&o&&o>0)return;const m=t.value>-1?t.value-1:x-1;d.value[m]?t.value=m:(t.value=-1,(w=h.value)==null||w.setSelectionRange(p.value.length,p.value.length))}else if(l.key==="ArrowRight"){if(t.value<0)return;const m=t.value+1;d.value[m]?t.value=m:(t.value=-1,(M=h.value)==null||M.setSelectionRange(0,0))}else~t.value&&xe(l)&&(t.value=-1)}function Oe(){var l;e.eager&&((l=u.value)==null||l.calculateVisibleItems())}function $e(){var l;y.value&&(C.value=!0,(l=h.value)==null||l.focus())}function A(l){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const x=d.value.findIndex(k=>(e.valueComparator||ge)(k.value,l.value)),i=o??!~x;if(~x){const k=i?[...d.value,l]:[...d.value];k.splice(x,1),d.value=k}else i&&(d.value=[...d.value,l]);e.clearOnSelect&&(p.value="")}else{const x=o!==!1;d.value=x?[l]:[],$.value=x&&!L.value?l.title:"",be(()=>{_.value=!1,C.value=!0})}}function je(l){y.value=!0,setTimeout(()=>{V.value=!0})}function Be(l){V.value=!1}function Ue(l){(l==null||l===""&&!e.multiple&&!L.value)&&(d.value=[])}return U(y,(l,o)=>{if(!(l||l===o)&&(t.value=-1,_.value=!1,p.value)){if(e.multiple){A(J(e,p.value));return}if(!L.value)return;d.value.some(x=>{let{title:i}=x;return i===p.value})?$.value="":A(J(e,p.value))}}),U(_,()=>{if(!e.hideSelected&&_.value&&d.value.length){const l=j.value.findIndex(o=>d.value.some(x=>(e.valueComparator||ge)(x.value,o.value)));Ye&&window.requestAnimationFrame(()=>{var o;l>=0&&((o=u.value)==null||o.scrollToIndex(l))})}}),U(()=>e.items,(l,o)=>{_.value||y.value&&!o.length&&l.length&&(_.value=!0)}),Ze(()=>{const l=!!(!e.hideNoData||j.value.length||n["prepend-item"]||n["append-item"]||n["no-data"]),o=d.value.length>0,x=ie.filterProps(e);return s(ie,N({ref:h},x,{modelValue:p.value,"onUpdate:modelValue":[i=>p.value=i,Ue],focused:y.value,"onUpdate:focused":i=>y.value=i,validationValue:d.externalValue,counterValue:Ae.value,dirty:o,class:["v-combobox",{"v-combobox--active-menu":_.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!L.value,"v-combobox--selecting-index":t.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:O.isReadonly.value,placeholder:o?void 0:e.placeholder,"onClick:clear":Ke,"onMousedown:control":Le,onKeydown:Te}),{...n,default:()=>s(W,null,[s(el,N({ref:c,modelValue:_.value,"onUpdate:modelValue":i=>_.value=i,activator:"parent",contentClass:"v-combobox__content",disabled:Z.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:Oe,onAfterLeave:$e},e.menuProps),{default:()=>[l&&s(ll,N({ref:ae,selected:Pe.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:i=>i.preventDefault(),onKeydown:Re,onFocusin:je,onFocusout:Be,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},De,e.listProps),{default:()=>{var i,k,w;return[(i=n["prepend-item"])==null?void 0:i.call(n),!j.value.length&&!e.hideNoData&&(((k=n["no-data"])==null?void 0:k.call(n))??s(ye,{key:"no-data",title:a(e.noDataText)},null)),s(_l,{ref:u,renderless:!0,items:j.value,itemKey:"value"},{default:M=>{var ve;let{item:m,index:B,itemRef:I}=M;const de=N(m.props,{ref:I,key:m.value,active:te.value&&B===0?!0:void 0,onClick:()=>A(m,null)});return((ve=n.item)==null?void 0:ve.call(n,{item:m,index:B,props:de}))??s(ye,N(de,{role:"option"}),{prepend:q=>{let{isSelected:Ne}=q;return s(W,null,[e.multiple&&!e.hideSelected?s(Cl,{key:m.value,modelValue:Ne,ripple:!1,tabindex:"-1"},null):void 0,m.props.prependAvatar&&s(tl,{image:m.props.prependAvatar},null),m.props.prependIcon&&s(he,{icon:m.props.prependIcon},null)])},title:()=>{var q;return C.value?m.title:Ml("v-combobox",m.title,(q=Me(m))==null?void 0:q.title)}})}}),(w=n["append-item"])==null?void 0:w.call(n)]}})]}),d.value.map((i,k)=>{function w(I){I.stopPropagation(),I.preventDefault(),A(i,!1)}const M={"onClick:close":w,onKeydown(I){I.key!=="Enter"&&I.key!==" "||(I.preventDefault(),I.stopPropagation(),w(I))},onMousedown(I){I.preventDefault(),I.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},m=X.value?!!n.chip:!!n.selection,B=m?al(X.value?n.chip({item:i,index:k,props:M}):n.selection({item:i,index:k})):void 0;if(!(m&&!B))return s("div",{key:i.value,class:["v-combobox__selection",k===t.value&&["v-combobox__selection--selected",T.value]],style:k===t.value?K.value:{}},[X.value?n.chip?s(ul,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:i.title}}},{default:()=>[B]}):s(nl,N({key:"chip",closable:e.closableChips,size:"small",text:i.title,disabled:i.props.disabled},M),null):B??s("span",{class:"v-combobox__selection-text"},[i.title,e.multiple&&k<d.value.length-1&&s("span",{class:"v-combobox__selection-comma"},[R(",")])])])})]),"append-inner":function(){var M,m;for(var i=arguments.length,k=new Array(i),w=0;w<i;w++)k[w]=arguments[w];return s(W,null,[(M=n["append-inner"])==null?void 0:M.call(n,...k),(!e.hideNoData||e.items.length)&&e.menuIcon?s(he,{class:"v-combobox__menu-icon",color:(m=h.value)==null?void 0:m.fieldIconColor,icon:e.menuIcon,onMousedown:Ee,onClick:qe,"aria-label":a(ce.value),title:a(ce.value),tabindex:"-1"},null):void 0])}})}),rl({isFocused:y,isPristine:C,menu:_,search:p,selectionIndex:t,filteredItems:Y,select:A},h)}}),Hl=Ve({__name:"attrs",props:["attrs"],setup(e,{expose:f}){const r=e,n=G(null),a=Ce({loading:!1,optionalAttrList:[],records:[]}),h=u=>{a.records.splice(u,1)},y=()=>{a.records.push({name:null,value:null})},C=u=>{var t=u.label;if(t){var v=!1;if(a.records.forEach(g=>{g.name==t&&(v=!0)}),v){se().show(t+"已存在",{color:"red"});return}u.name=t,delete u.label}},V=()=>n.value.validate().then(({valid:u,errors:t})=>u?a.records:Promise.reject(t));U(()=>r.attrs,(u,t)=>{Array.isArray(u)&&u!==t&&(a.records=u)});const c=()=>{bl("product-attr").then(u=>{u.data&&u.data.code===200&&(a.definedAttrList=u.data.data),a.definedAttrList.forEach(t=>{t.name&&(t.required?a.records.push({name:t.name,value:null}):a.optionalAttrList.push(t.name))})})};return cl(()=>{c()}),f({getData:V}),(u,t)=>(S(),E(re,{class:"my-3"},{default:b(()=>[s(pe,{class:"text-blue bg-blue-lighten-5 text-subtitle-1 d-flex justify-space-between"},{default:b(()=>[t[1]||(t[1]=R(" 产品属性 ")),s(H,{size:"small",variant:"elevated",color:"primary",onClick:y},{default:b(()=>t[0]||(t[0]=[R(" 添加属性 ")])),_:1,__:[0]})]),_:1,__:[1]}),s(Se,{class:"py-3"},{default:b(()=>[s(hl,{ref_key:"refForm",ref:n},{default:b(()=>[s(Fe,{dense:""},{default:b(()=>[(S(!0),oe(W,null,we(a.records,(v,g)=>(S(),E(Ie,{lg:"3",xl:"3",md:"4",sm:"6"},{default:b(()=>[v.name?(S(),E(ie,{key:0,modelValue:v.value,"onUpdate:modelValue":F=>v.value=F,label:v.name,rules:[Q(gl).required]},{"append-inner":b(()=>[s(H,{size:"small",variant:"plain",color:"red",onClick:_e(F=>h(g),["prevent"])},{default:b(()=>t[2]||(t[2]=[R("删除")])),_:2,__:[2]},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","label","rules"])):(S(),E(Dl,{key:1,modelValue:v.label,"onUpdate:modelValue":F=>v.label=F,label:"属性",items:a.optionalAttrList},{"append-inner":b(()=>[v.label?(S(),E(H,{key:0,size:"small",variant:"plain",color:"red",onClick:_e(F=>C(v),["prevent"])},{default:b(()=>t[3]||(t[3]=[R("OK")])),_:2,__:[3]},1032,["onClick"])):ee("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","items"]))]),_:2},1024))),256))]),_:1})]),_:1},512)]),_:1})]),_:1}))}}),Kl={key:0,class:"d-flex bg-grey v-card--reveal text-h2",style:{height:"100%"}},Ll=Ve({__name:"images",props:["images","cover"],setup(e,{expose:f}){const r=e,n=G(null),a=Ce({loading:!1,maxCounts:8,records:["","","",""],cover:""}),h=c=>{a.records[c]=""},y=()=>{if(a.records.length>=a.maxCounts){se().error(`相册图片不能超过${a.maxCounts}个`);return}else a.records.push("")},C=c=>{a.records[c]&&(a.cover=a.records[c])},V=()=>{var c=[];for(let u=0;u<a.records.length;++u)a.records[u]&&(c.push(a.records[u]),a.cover||(a.cover=a.records[u]));return c.length===0?(se().show("至少上传1张产品图",{color:"red"}),Promise.reject(!1)):{images:c,cover:a.cover}};return U(()=>r.images,(c,u)=>{if(Array.isArray(c)&&c!==u)for(let t=0;t<c.length&&t<a.maxCounts;++t)c[t]&&(a.records[t]=c[t])}),U(()=>r.cover,(c,u)=>{c&&c!==u&&(a.cover=c)}),f({getData:V}),(c,u)=>{const t=pl;return S(),E(re,{class:"my-3"},{default:b(()=>[s(pe,{class:"text-blue bg-blue-lighten-5 text-subtitle-1 d-flex justify-space-between"},{default:b(()=>[u[2]||(u[2]=fl("span",null,"产品相册",-1)),s(H,{size:"small",color:"info",onClick:y},{default:b(()=>u[1]||(u[1]=[R("新增图片")])),_:1,__:[1]})]),_:1,__:[2]}),s(Se,{class:"py-3"},{default:b(()=>[s(t,{ref_key:"refUpload",ref:n,onSuccess:u[0]||(u[0]=(v,g)=>a.records[g]=v)},null,512),s(Fe,{dense:""},{default:b(()=>[(S(!0),oe(W,null,we(a.records,(v,g)=>(S(),E(Ie,{lg:"3",xl:"3",md:"4",sm:"6"},{default:b(()=>[s(Fl,null,{default:b(({isHovering:F,props:D})=>[s(re,N({"max-width":"500",variant:"text",color:"white",ref_for:!0},D),{default:b(()=>[s(dl,{src:v||"/images/404.png",height:"240",cover:""},{default:b(()=>[s(vl,null,{default:b(()=>[F?(S(),oe("div",Kl,[s(H,{color:"primary",size:"small",class:"mx-1",onClick:T=>n.value.trigger(g)},{default:b(()=>u[3]||(u[3]=[R("上传图")])),_:2,__:[3]},1032,["onClick"]),v?(S(),E(H,{key:0,color:"error",size:"small",class:"mx-1",onClick:T=>h(g)},{default:b(()=>u[4]||(u[4]=[R("删除")])),_:2,__:[4]},1032,["onClick"])):ee("",!0),v&&v!=a.cover?(S(),E(H,{key:1,color:"success",size:"small",class:"mx-1",onClick:T=>C(g)},{default:b(()=>u[5]||(u[5]=[R("设为封面")])),_:2,__:[5]},1032,["onClick"])):ee("",!0)])):ee("",!0)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1040)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1})}}}),Gl=ml(Ll,[["__scopeId","data-v-810aeb1d"]]);export{Gl as A,Hl as _};
