import{d as b,s as m,r as x,o as F,c as V,a as c,w as o,b as l,q as I,h as i,G as w,k as S,x as h,y as B,aC as j,E as z,j as A,F as E,z as $,V as v,l as q,g as f,H,u as y}from"./index-CBQGO4TK.js";import{i as L,k as M,g as N}from"./admin-DqLRzy3m.js";import{V as P}from"./VForm-CEf76I9c.js";import{V as D}from"./VFileInput-DpPgAFdq.js";import{V as s}from"./VTextField-DJVw3mL1.js";import{V as R}from"./VTooltip-CDuPQOfQ.js";import{V as G}from"./VAlert-00fnD3BY.js";import"./VInput-VBAr4TQG.js";import"./VField-DFRgda3J.js";const J=["innerHTML"],le=b({__name:"service-list",setup(K){const u=m(null),p=m(null),g=m(null),r=x({loading:!1,type:"homepage-service-list",maxCounts:3,currentIndex:0,record:{mainTitle:"",subTitle:"",records:[]}});function _(a){r.currentIndex=a,p.value.$el.querySelector('input[type="file"]').click()}const U=a=>new Promise((e,t)=>{const d=new FormData;d.append("image",a),L(d).then(n=>n.data.data).then(n=>{r.record.records[r.currentIndex].imgUrl=n}).catch(n=>{console.error("Error:",n)})}),C=a=>{r.record.records[a].imgUrl="",r.record.records[a].toUrl="",r.record.records[a].title=""},k=()=>{r.loading=!0,g.value.validate().then(a=>{if(!a.valid)return Promise.reject(!1);var e=0;return r.record.records.forEach(t=>{t.imgUrl&&(e+=1)}),e<1?(y().show("至少需要5张图",{color:"red"}),Promise.reject(!1)):M(r.type,r.record)}).then(a=>{a.data&&a.data.code===200&&y().show("保存成功")}).finally(()=>{r.loading=!1})},T=()=>{N(r.type).then(a=>{if(a.data&&a.data.code===200){Array.isArray(a.data.data)&&a.data.data.length>0&&(r.record=a.data.data[0]);for(let e=r.record.records.length;e<r.maxCounts;++e)r.record.records.push({imgUrl:"",toUrl:"",title:""})}}).catch(a=>{console.error(a)})};return F(()=>{T()}),(a,e)=>(c(),V(v,{loading:r.loading,"max-width":"1000"},{default:o(()=>[l(I,{class:"bg-primary"},{default:o(()=>[l(w,{icon:"mdi-professional-hexagon",size:"small",class:"mr-1"}),e[3]||(e[3]=i(" 公司专业服务 "))]),_:1,__:[3]}),l(S,{class:"bg-grey-lighten-2 py-2"},{default:o(()=>e[4]||(e[4]=[i(" 设置首页的专业服务区: 标题以及图片列表 ")])),_:1,__:[4]}),l(h,null,{default:o(()=>[l(P,{ref_key:"refForm",ref:g},{default:o(()=>[l(D,{ref_key:"refFileInput",ref:p,modelValue:z(u),"onUpdate:modelValue":[e[0]||(e[0]=t=>j(u)?u.value=t:null),U],accept:"image/*",class:"d-none"},null,8,["modelValue"]),l(s,{modelValue:r.record.mainTitle,"onUpdate:modelValue":e[1]||(e[1]=t=>r.record.mainTitle=t),label:"主标题"},{default:o(()=>[l(R,{activator:"parent",location:"top"},{default:o(()=>[l(G,{class:"bg-transparent",density:"compact"},{default:o(()=>e[5]||(e[5]=[i(" 以**举例**包括的文字，会以蓝色显示 ")])),_:1,__:[5]}),A("div",{innerHTML:r.record.mainTitle.replace(/\*\*(.+?)\*\*/g,"<span class='text-primary'>$1</span>")},null,8,J)]),_:1})]),_:1},8,["modelValue"]),l(s,{modelValue:r.record.subTitle,"onUpdate:modelValue":e[2]||(e[2]=t=>r.record.subTitle=t),label:"副标题"},null,8,["modelValue"]),(c(!0),B(E,null,$(r.record.records,(t,d)=>(c(),V(v,{variant:"text"},{default:o(()=>[l(q,{src:t.imgUrl||"/images/404.png",width:"312"},null,8,["src"]),l(s,{modelValue:t.title,"onUpdate:modelValue":n=>t.title=n,label:"图片标题",placeholder:"位于图片下方"},null,8,["modelValue","onUpdate:modelValue"]),l(s,{modelValue:t.toUrl,"onUpdate:modelValue":n=>t.toUrl=n,label:"链接地址",placeholder:"点击横幅图跳转的链接地址（可选）"},{"append-inner":o(()=>[l(f,{color:"primary",size:"small",variant:"plain",onClick:n=>_(d)},{default:o(()=>e[6]||(e[6]=[i("上传专业服务图")])),_:2,__:[6]},1032,["onClick"]),l(f,{color:"error",size:"small",variant:"plain",onClick:n=>C(d)},{default:o(()=>e[7]||(e[7]=[i("删除")])),_:2,__:[7]},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024))),256))]),_:1},512)]),_:1}),l(H,null,{default:o(()=>[l(f,{loading:r.loading,variant:"elevated",color:"primary",onClick:k},{default:o(()=>e[8]||(e[8]=[i("保存")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},8,["loading"]))}});export{le as default};
