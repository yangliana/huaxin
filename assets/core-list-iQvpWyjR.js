import{d as k,s as m,r as F,o as x,c as g,a as c,w as n,b as r,q as w,h as d,G as I,k as h,x as S,y as B,aC as j,E as z,j as A,F as E,z as $,V as y,l as q,g as p,H,u as U}from"./index-CBQGO4TK.js";import{i as L,k as M,g as N}from"./admin-DqLRzy3m.js";import{V as P}from"./VForm-CEf76I9c.js";import{V as D}from"./VFileInput-DpPgAFdq.js";import{V as i}from"./VTextField-DJVw3mL1.js";import{V as R}from"./VTooltip-CDuPQOfQ.js";import{V as G}from"./VAlert-00fnD3BY.js";import{V as J}from"./VTextarea-CrPksE0y.js";import"./VInput-VBAr4TQG.js";import"./VField-DFRgda3J.js";const K=["innerHTML"],oe=k({__name:"core-list",setup(O){const u=m(null),f=m(null),V=m(null),e=F({loading:!1,type:"homepage-core-list",maxCounts:4,currentIndex:0,record:{mainTitle:"",subTitle:"",records:[]}});function _(a){e.currentIndex=a,f.value.$el.querySelector('input[type="file"]').click()}const b=a=>new Promise((l,t)=>{const s=new FormData;s.append("image",a),L(s).then(o=>o.data.data).then(o=>{e.record.records[e.currentIndex].imgUrl=o}).catch(o=>{console.error("Error:",o)})}),v=a=>{e.record.records[a].imgUrl="",e.record.records[a].toUrl="",e.record.records[a].title="",e.record.records[a].subTitle="",e.record.records[a].summary=""},T=()=>{e.loading=!0,V.value.validate().then(a=>{if(!a.valid)return Promise.reject(!1);var l=0;return e.record.records.forEach(t=>{t.imgUrl&&(l+=1)}),l<1?(U().show("至少需要4张图",{color:"red"}),Promise.reject(!1)):M(e.type,e.record)}).then(a=>{a.data&&a.data.code===200&&U().show("保存成功")}).finally(()=>{e.loading=!1})},C=()=>{N(e.type).then(a=>{if(a.data&&a.data.code===200){Array.isArray(a.data.data)&&a.data.data.length>0&&(e.record=a.data.data[0]);for(let l=e.record.records.length;l<e.maxCounts;++l)e.record.records.push({imgUrl:"",toUrl:"",title:"",subTitle:"",summary:""})}}).catch(a=>{console.error(a)})};return x(()=>{C()}),(a,l)=>(c(),g(y,{loading:e.loading,"max-width":"1000"},{default:n(()=>[r(w,{class:"bg-primary"},{default:n(()=>[r(I,{icon:"mdi-star-shooting-outline",size:"small",class:"mr-1"}),l[3]||(l[3]=d(" 四大核心优势 "))]),_:1,__:[3]}),r(h,{class:"bg-grey-lighten-2 py-2"},{default:n(()=>l[4]||(l[4]=[d(" 设置首页的公司四大核心优势 ")])),_:1,__:[4]}),r(S,null,{default:n(()=>[r(P,{ref_key:"refForm",ref:V},{default:n(()=>[r(D,{ref_key:"refFileInput",ref:f,modelValue:z(u),"onUpdate:modelValue":[l[0]||(l[0]=t=>j(u)?u.value=t:null),b],accept:"image/*",class:"d-none"},null,8,["modelValue"]),r(i,{modelValue:e.record.mainTitle,"onUpdate:modelValue":l[1]||(l[1]=t=>e.record.mainTitle=t),label:"主标题"},{default:n(()=>[r(R,{activator:"parent",location:"top"},{default:n(()=>[r(G,{class:"bg-transparent",density:"compact"},{default:n(()=>l[5]||(l[5]=[d(" 以**举例**包括的文字，会以蓝色显示 ")])),_:1,__:[5]}),A("div",{innerHTML:e.record.mainTitle.replace(/\*\*(.+?)\*\*/g,"<span class='text-primary'>$1</span>")},null,8,K)]),_:1})]),_:1},8,["modelValue"]),r(i,{modelValue:e.record.subTitle,"onUpdate:modelValue":l[2]||(l[2]=t=>e.record.subTitle=t),label:"副标题"},null,8,["modelValue"]),(c(!0),B(E,null,$(e.record.records,(t,s)=>(c(),g(y,{variant:"text"},{default:n(()=>[r(q,{src:t.imgUrl||"/images/404.png",width:"312"},null,8,["src"]),r(i,{modelValue:t.title,"onUpdate:modelValue":o=>t.title=o,label:"核心优势: 标题",placeholder:"图片主标题"},null,8,["modelValue","onUpdate:modelValue"]),r(i,{modelValue:t.subTitle,"onUpdate:modelValue":o=>t.subTitle=o,label:"核心优势: 副标题(英文)",placeholder:"图片副标题(英文)"},null,8,["modelValue","onUpdate:modelValue"]),r(J,{modelValue:t.summary,"onUpdate:modelValue":o=>t.summary=o,label:"核心优势: 摘要",rows:"3"},null,8,["modelValue","onUpdate:modelValue"]),r(i,{modelValue:t.toUrl,"onUpdate:modelValue":o=>t.toUrl=o,label:"链接地址",placeholder:"点击横幅图跳转的链接地址（可选）"},{"append-inner":n(()=>[r(p,{color:"primary",size:"small",variant:"plain",onClick:o=>_(s)},{default:n(()=>l[6]||(l[6]=[d("上传图片")])),_:2,__:[6]},1032,["onClick"]),r(p,{color:"error",size:"small",variant:"plain",onClick:o=>v(s)},{default:n(()=>l[7]||(l[7]=[d("删除")])),_:2,__:[7]},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024))),256))]),_:1},512)]),_:1}),r(H,null,{default:n(()=>[r(p,{loading:e.loading,variant:"elevated",color:"primary",onClick:T},{default:n(()=>l[8]||(l[8]=[d("保存")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},8,["loading"]))}});export{oe as default};
