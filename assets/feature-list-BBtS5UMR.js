import{d as F,s as u,r as b,o as T,c as V,a as m,w as o,b as l,q as I,h as i,G as w,k as S,x as h,y as B,aC as z,E,F as j,z as q,V as y,l as A,g as c,H as P,u as v}from"./index-6yqTO6Xn.js";import{i as $,k as D,g as N}from"./admin-BsvIVDVa.js";import{V as R}from"./VForm-X9FYPwC0.js";import{V as G}from"./VFileInput-WiayrU4c.js";import{V as f}from"./VTextField-DmoPaxrQ.js";import"./VInput-jUQZEwvB.js";import"./VField-D4f68aLd.js";const X=F({__name:"feature-list",setup(H){const s=u(null),p=u(null),g=u(null),r=b({loading:!1,type:"homepage-feature-list",maxCounts:6,currentIndex:0,record:{mainTitle:"",subTitle:"",records:[]}});function C(a){r.currentIndex=a,p.value.$el.querySelector('input[type="file"]').click()}const U=a=>new Promise((e,t)=>{const d=new FormData;d.append("image",a),$(d).then(n=>n.data.data).then(n=>{r.record.records[r.currentIndex].imgUrl=n}).catch(n=>{console.error("Error:",n)})}),_=a=>{r.record.records[a].imgUrl="",r.record.records[a].toUrl=""},k=()=>{r.loading=!0,g.value.validate().then(a=>{if(!a.valid)return Promise.reject(!1);var e=0;return r.record.records.forEach(t=>{t.imgUrl&&(e+=1)}),e<1?(v().show("至少需要5张图",{color:"red"}),Promise.reject(!1)):D(r.type,r.record)}).then(a=>{a.data&&a.data.code===200&&v().show("保存成功")}).finally(()=>{r.loading=!1})},x=()=>{N(r.type).then(a=>{if(a.data&&a.data.code===200){Array.isArray(a.data.data)&&a.data.data.length>0&&(r.record=a.data.data[0]);for(let e=r.record.records.length;e<r.maxCounts;++e)r.record.records.push({imgUrl:"",toUrl:""})}}).catch(a=>{console.error(a)})};return T(()=>{x()}),(a,e)=>(m(),V(y,{loading:r.loading,"max-width":"1000"},{default:o(()=>[l(I,{class:"bg-primary"},{default:o(()=>[l(w,{icon:"mdi-shield-star-outline",size:"small",class:"mr-1"}),e[3]||(e[3]=i(" 公司优势列表 "))]),_:1,__:[3]}),l(S,{class:"bg-grey-lighten-2 py-2"},{default:o(()=>e[4]||(e[4]=[i(" 设置首页的公司优势列表 ")])),_:1,__:[4]}),l(h,null,{default:o(()=>[l(R,{ref_key:"refForm",ref:g},{default:o(()=>[l(G,{ref_key:"refFileInput",ref:p,modelValue:E(s),"onUpdate:modelValue":[e[0]||(e[0]=t=>z(s)?s.value=t:null),U],accept:"image/*",class:"d-none"},null,8,["modelValue"]),l(f,{modelValue:r.record.mainTitle,"onUpdate:modelValue":e[1]||(e[1]=t=>r.record.mainTitle=t),label:"主标题"},null,8,["modelValue"]),l(f,{modelValue:r.record.subTitle,"onUpdate:modelValue":e[2]||(e[2]=t=>r.record.subTitle=t),label:"副标题"},null,8,["modelValue"]),(m(!0),B(j,null,q(r.record.records,(t,d)=>(m(),V(y,{variant:"text"},{default:o(()=>[l(A,{src:t.imgUrl||"/images/404.png",width:"128"},null,8,["src"]),l(f,{modelValue:t.toUrl,"onUpdate:modelValue":n=>t.toUrl=n,label:"链接地址",placeholder:"点击横幅图跳转的链接地址（可选）"},{"append-inner":o(()=>[l(c,{color:"primary",size:"small",variant:"plain",onClick:n=>C(d)},{default:o(()=>e[5]||(e[5]=[i("上传横幅图")])),_:2,__:[5]},1032,["onClick"]),l(c,{color:"error",size:"small",variant:"plain",onClick:n=>_(d)},{default:o(()=>e[6]||(e[6]=[i("删除")])),_:2,__:[6]},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024))),256))]),_:1},512)]),_:1}),l(P,null,{default:o(()=>[l(c,{loading:r.loading,variant:"elevated",color:"primary",onClick:k},{default:o(()=>e[7]||(e[7]=[i("保存")])),_:1,__:[7]},8,["loading"])]),_:1})]),_:1},8,["loading"]))}});export{X as default};
