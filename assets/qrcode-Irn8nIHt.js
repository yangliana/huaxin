import{d as k,s as p,r as y,o as h,c as m,a as d,w as l,b as o,q as x,h as n,G as S,k as w,x as F,V as _,i as b,y as B,F as z,z as E,e as R,l as T,K as I,g as u,E as N,H as $,u as V}from"./index-CgpHTJ9_.js";import{r as j}from"./validate-BxfLMkoi.js";import{q as A,t as P}from"./admin-BidussuP.js";import{_ as Q}from"./uploadImage.vue_vue_type_script_setup_true_lang-C_cAU7XS.js";import{V as G}from"./VForm-CUPs4Puc.js";import{V as H}from"./VTextField-GMKXjoVd.js";import"./VFileInput-DecipcqC.js";import"./VField-CqBiyUiR.js";import"./VInput-uEpnQqPP.js";const Z=k({__name:"qrcode",setup(K){const f=p(null),c=p(null),t=y({loading:!1,maxCounts:4,records:[]}),C=(r,e)=>t.records[e].imgUrl?j.required(r):!0,v=r=>{t.records[r].imgUrl="",t.records[r].title=""},U=()=>{t.loading=!0,f.value.validate().then(r=>{if(!r.valid)return Promise.reject(!1);var e=!1;return t.records.forEach(a=>{a.imgUrl&&(e=!0)}),e?A(t.records):(V().show("至少上传一个二维码",{color:"red"}),Promise.reject(!1))}).then(r=>{r.data&&r.data.code===200&&(V().show("保存成功"),g())}).finally(()=>{t.loading=!1})},g=()=>{P().then(r=>{if(r.data&&r.data.code===200){var e=[];r.data.data.forEach(a=>{e.push({title:a.title||"",imgUrl:a.imgUrl||""})});for(let a=e.length;a<t.maxCounts;++a)e.push({title:"",imgUrl:""});t.records=e}}).catch(r=>{console.error(r)})};return h(()=>{g()}),(r,e)=>(d(),m(_,{loading:t.loading},{default:l(()=>[o(x,{class:"bg-success"},{default:l(()=>[o(S,{icon:"mdi-qrcode",size:"small"}),e[1]||(e[1]=n(" 设置二维码 "))]),_:1,__:[1]}),o(w,{class:"py-2"},{default:l(()=>e[2]||(e[2]=[n(" 二维码用于公共页尾展示 ")])),_:1,__:[2]}),o(G,{ref_key:"refForm",ref:f},{default:l(()=>[o(F,null,{default:l(()=>[o(Q,{ref_key:"refUpload",ref:c,onSuccess:e[0]||(e[0]=(a,s)=>t.records[s].imgUrl=a)},null,512),o(_,{variant:"text","max-width":"1200"},{default:l(()=>[o(b,{dense:""},{default:l(()=>[(d(!0),B(z,null,E(t.records,(a,s)=>(d(),m(R,{cols:"6",md:"3"},{default:l(()=>[o(T,{src:a.imgUrl||"/images/404.png",height:"200"},null,8,["src"]),o(H,{modelValue:a.title,"onUpdate:modelValue":i=>a.title=i,rules:[i=>C(i,s)],label:"标题",placeholder:"二维码下方的文字"},{"append-inner":l(()=>[o(u,{size:"small",variant:"plain",color:"primary",onClick:i=>N(c).trigger(s)},{default:l(()=>e[3]||(e[3]=[n("上传")])),_:2,__:[3]},1032,["onClick"]),a.imgUrl?(d(),m(u,{key:0,size:"small",variant:"plain",color:"error","prepend-icon":"mdi-trash-can",onClick:i=>v(s)},{default:l(()=>e[4]||(e[4]=[n("删除")])),_:2,__:[4]},1032,["onClick"])):I("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024))),256))]),_:1})]),_:1})]),_:1}),o($,null,{default:l(()=>[o(u,{loading:t.loading,variant:"elevated",color:"primary",onClick:U},{default:l(()=>e[5]||(e[5]=[n("保存")])),_:1,__:[5]},8,["loading"])]),_:1})]),_:1},512)]),_:1},8,["loading"]))}});export{Z as default};
